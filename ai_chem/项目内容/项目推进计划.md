# ChemTutor 项目推进计划

**版本**: v1.0
**日期**: 2026-01-30
**目标**: 高中化学可视化交互解答平台 MVP

---

## 项目总览

```
第一阶段                  第二阶段                  第三阶段
环境搭建                 核心功能                 完善优化
   │                        │                        │
   ▼                        ▼                        ▼
[1-2周]                 [3-8周]                   [9-12周]
技术选型               问答+可视化              追问+练习
基础架构                方程式生成               体验优化
```

---

## 第一阶段：环境搭建与基础架构（1-2周）

### Week 1: 项目初始化

#### 任务1.1: 技术栈确定
**选择方案**:
- 前端: React 18 + TypeScript + Vite
- 3D可视化: 3Dmol.js
- 后端: Python + FastAPI
- AI: OpenAI API / Claude API
- 数据库: Neo4j (图数据库) + PostgreSQL

**输出**: 技术架构文档

---

#### 任务1.2: 项目脚手架搭建

**前端初始化**:
```bash
# 创建前端项目
npm create vite@latest chemtutor-frontend -- --template react-ts
cd chemtutor-frontend
npm install

# 安装核心依赖
npm install @3dmol/3dmol.js  # 3D分子可视化
npm install axios             # HTTP请求
npm install zustand           # 状态管理
npm install katex             # 公式渲染
npm install framer-motion     # 动画
```

**后端初始化**:
```bash
# 创建后端项目
mkdir chemtutor-backend
cd chemtutor-backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

pip install fastapi uvicorn langchain openai neo4j psycopg2-binary python-multipart
```

**输出**: 可运行的前后端空项目

---

#### 任务1.3: 基础UI框架

**创建页面结构**:
```
src/
├── App.tsx           # 主入口
├── pages/
│   ├── Home.tsx      # 主页（问答界面）
│   └── Viewer.tsx    # 3D可视化页面
├── components/
│   ├── QuestionInput.tsx    # 问题输入框
│   ├── AnswerPanel.tsx      # 回答面板
│   └── MoleculeViewer.tsx   # 分子3D展示
└── api/
    └── client.ts      # API请求封装
```

**目标界面**:
```
┌─────────────────────────────────────┐
│         ChemTutor                    │
├─────────────────────────────────────┤
│  [输入问题...]              [提问]  │
├─────────────────────────────────────┤
│                                     │
│         回答/可视化区域              │
│                                     │
└─────────────────────────────────────┘
```

**输出**: 可展示的基础界面

---

### Week 2: 后端API基础

#### 任务2.1: FastAPI基础服务

**创建文件结构**:
```
backend/
├── main.py              # FastAPI入口
├── api/
│   └── chat.py          # 问答API
├── models/
│   └── request.py       # 请求模型
└── services/
    └── llm.py           # LLM调用服务
```

**基础API实现** (`main.py`):
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="ChemTutor API")

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
async def root():
    return {"message": "ChemTutor API is running"}

@app.post("/api/chat")
async def chat(question: str):
    # Week 3实现
    return {"answer": "待实现"}
```

**输出**: 可访问的后端API服务

---

#### 任务2.2: LLM接入测试

**创建LLM服务** (`services/llm.py`):
```python
import os
from openai import OpenAI

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def ask_llm(question: str) -> str:
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "你是一个高中化学助教"},
            {"role": "user", "content": question}
        ]
    )
    return response.choices[0].message.content
```

**测试问题**:
- "什么是化学键？"
- "水的化学式是什么？"

**输出**: LLM能正常回答化学问题

---

## 第二阶段：核心功能开发（3-8周）

### Week 3: 化学问答基础

#### 任务3.1: 化学问题理解Prompt

**创建专业Prompt**:
```python
CHEMISTRY_SYSTEM_PROMPT = """
你是一个高中化学AI助教。请分析学生的化学问题并输出JSON格式：

{
  "主题": "原子结构/化学键/化学反应/...",
  "涉及的物质": ["H2O", "NH3"],
  "问题类型": "概念解释/方程式/计算/实验",
  "难度": 1-5,
  "核心概念": ["极性", "分子构型"],
  "讲解策略": "建议的讲解方式"
}

问题：{question}
"""
```

**输出**: 结构化的化学问题分析

---

#### 任务3.2: 前后端联调

**前端请求** (`api/client.ts`):
```typescript
export async function askQuestion(question: string) {
  const response = await fetch('http://localhost:8000/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ question })
  });
  return response.json();
}
```

**后端响应格式**:
```json
{
  "分析": {...},
  "回答": "详细解释...",
  "相关知识点": ["分子极性", "VSEPR理论"]
}
```

**输出**: 用户提问能看到结构化回答

---

### Week 4-5: 3D分子可视化

#### 任务4.1: 3Dmol.js集成

**创建分子查看器** (`components/MoleculeViewer.tsx`):
```typescript
import { useEffect, useRef } from 'react';

export function MoleculeViewer({ molecule }: { molecule: string }) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!containerRef.current) return;

    const viewer = $3Dmol.createViewer(containerRef.current, {});
    viewer.addModel(molecule, "xyz");
    viewer.zoomTo();
    viewer.render();

    return () => { viewer.clear(); };
  }, [molecule]);

  return <div ref={containerRef} style={{ width: '100%', height: '400px' }} />;
}
```

**分子数据格式**:
```javascript
const NH3_DATA = `
2
NH3
N 0.000 0.000 0.000
H 0.940 0.000 -0.385
H -0.470 0.813 -0.385
H -0.470 -0.813 -0.385
`;
```

**输出**: 能在页面上看到可旋转的3D分子

---

#### 任务4.2: 常见分子数据库

**创建分子数据** (`data/molecules.ts`):
```typescript
export const MOLECULES = {
  NH3: {
    name: "氨",
    formula: "NH3",
    data: "...",  // XYZ坐标
    properties: {
      polarity: "极性",
      geometry: "三角锥形",
      bondAngle: "107.3°"
    }
  },
  H2O: {
    name: "水",
    formula: "H2O",
    data: "...",
    properties: {
      polarity: "极性",
      geometry: "V形",
      bondAngle: "104.5°"
    }
  },
  // 添加更多...
};
```

**输出**: 至少10个常见分子的3D数据

---

#### 任务4.3: LLM生成可视化指令

**增强Prompt**:
```python
def get_visualization_prompt(question: str) -> dict:
    prompt = f"""
    分析这个化学问题需要展示什么可视化内容：

    问题：{question}

    输出JSON：
    {{
      "可视化类型": "3D分子模型/反应动画/图表",
      "涉及的分子": ["NH3"],
      "需要显示": ["偶极矩", "孤对电子"],
      "讲解重点": "分子构型与极性的关系"
    }}
    """
    return call_llm(prompt)
```

**输出**: LLM能判断需要什么可视化

---

### Week 6: 化学反应方程式

#### 任务6.1: 方程式生成

**创建方程式服务**:
```python
import re

def generate_equation(description: str) -> dict:
    prompt = f"""
    根据描述生成配平的化学方程式：

    描述：{description}

    输出JSON：
    {{
      "反应物": ["H2", "O2"],
      "生成物": ["H2O"],
      "系数": [2, 1, 2],
      "条件": "点燃",
      "方程式": "2H2 + O2 =(点燃)= 2H2O"
    }}
    """
    return call_llm(prompt)
```

**测试用例**:
- "氢气在氧气中燃烧"
- "铜和浓硝酸反应"
- "氨气催化氧化"

**输出**: 能正确生成常见反应方程式

---

#### 任务6.2: 方程式展示组件

**创建展示组件** (`components/EquationDisplay.tsx`):
```typescript
interface EquationProps {
  equation: string;
  condition?: string;
}

export function EquationDisplay({ equation, condition }: EquationProps) {
  return (
    <div className="equation">
      <span className="equation-text">{equation}</span>
      {condition && <span className="condition">{condition}</span>}
    </div>
  );
}
```

**样式美化**:
- 使用KaTeX渲染化学式
- 箭头样式
- 条件标注

**输出**: 美观的方程式展示

---

### Week 7: 知识图谱基础

#### 任务7.1: Neo4j数据库搭建

**安装Neo4j**:
```bash
# Docker方式
docker run -p 7474:7474 -p 7687:7687 \
  -e NEO4J_AUTH=neo4j/password \
  neo4j:latest
```

**创建基础数据**:
```cypher
// 创建氮的化合物图谱
CREATE (n1:Element {name: "氮", symbol: "N"})
CREATE (c1:Compound {name: "氨气", formula: "NH3"})
CREATE (c2:Compound {name: "一氧化氮", formula: "NO"})
CREATE (c3:Compound {name: "二氧化氮", formula: "NO2"})

CREATE (n1)-[:化合物]->(c1)
CREATE (n1)-[:化合物]->(c2)
CREATE (n1)-[:化合物]->(c3)

CREATE (c1)-[:氧化]->(c2)
CREATE (c2)-[:氧化]->(c3)
```

**输出**: 可查询的化学知识图谱

---

#### 任务7.2: 知识检索

**创建检索服务**:
```python
from neo4j import GraphDatabase

driver = GraphDatabase.driver("bolt://localhost:7687")

def search_knowledge(topic: str) -> list:
    with driver.session() as session:
        result = session.run(
            """
            MATCH (n)-[r]->(m)
            WHERE n.name CONTAINS $topic OR m.name CONTAINS $topic
            RETURN n, r, m
            LIMIT 10
            """,
            topic=topic
        )
        return [record for record in result]
```

**输出**: 能检索相关化学知识

---

### Week 8: 界面完善

#### 任务8.1: 完整问答流程

**实现完整交互**:
1. 用户输入问题
2. 显示加载动画
3. 返回结构化回答：
   - 文字解释
   - 3D可视化（如果有）
   - 方程式（如果有）
   - 相关知识点

**界面示例**:
```
┌─────────────────────────────────────────┐
│ 问: 为什么氨气是极性分子？              │
├─────────────────────────────────────────┤
│ 【文字解释】                            │
│ 氨气(NH3)分子中...                      │
│                                         │
│ 【3D分子模型】                          │
│      [旋转的NH3分子]                    │
│      三角锥形，键角107.3°               │
│                                         │
│ 【相关知识点】                          │
│ • VSEPR理论  • 分子极性  • 孤对电子    │
└─────────────────────────────────────────┘
```

**输出**: 完整的问答体验

---

## 第三阶段：功能完善（9-12周）

### Week 9: 追问功能

#### 任务9.1: 对话历史管理

**前端状态管理** (`store/chatStore.ts`):
```typescript
interface Message {
  role: 'user' | 'assistant';
  content: string;
  data?: any;
}

export const useChatStore = create((set) => ({
  messages: [],
  addMessage: (msg: Message) =>
    set((state) => ({ messages: [...state.messages, msg] })),
}));
```

**后端上下文处理**:
```python
def chat_with_context(question: str, history: list) -> str:
    messages = [
        {"role": "system", "content": CHEMISTRY_SYSTEM_PROMPT},
        *history,
        {"role": "user", "content": question}
    ]
    response = client.chat.completions.create(
        model="gpt-4",
        messages=messages
    )
    return response.choices[0].message.content
```

**输出**: 支持连续追问

---

### Week 10: 练习题生成

#### 任务10.1: 题目生成Prompt

```python
def generate_practice_questions(topic: str, difficulty: int) -> list:
    prompt = f"""
    为以下主题生成3道练习题：

    主题：{topic}
    难度：{difficulty}/5

    输出JSON：
    [
      {{
        "题型": "选择题/填空题/判断题",
        "题目": "...",
        "选项": ["A", "B", "C", "D"],
        "答案": "A",
        "解析": "..."
      }}
    ]
    """
    return call_llm(prompt)
```

**输出**: 能生成相关练习题

---

### Week 11: 知识点收藏

#### 任务11.1: 收藏功能

**前端实现**:
```typescript
export function FavoriteButton({ topic }: { topic: string }) {
  const favorites = useChatStore(s => s.favorites);

  const toggleFavorite = () => {
    // 调用API保存/取消收藏
  };

  return (
    <button onClick={toggleFavorite}>
      {favorites.includes(topic) ? '★ 已收藏' : '☆ 收藏'}
    </button>
  );
}
```

**后端存储**:
```python
@app.post("/api/favorites")
async def add_favorite(user_id: str, topic: str):
    # 保存到数据库
    pass
```

**输出**: 可收藏和查看收藏的知识点

---

### Week 12: 体验优化

#### 任务12.1: 性能优化

- 3D模型懒加载
- API响应缓存
- 加载状态优化

#### 任务12.2: UI美化

- 统一配色方案
- 响应式布局
- 动画过渡

**输出**: 流畅、美观的用户体验

---

## 里程碑检查点

### 里程碑1: 第2周末
**检查项**:
- [ ] 前后端项目可运行
- [ ] 前端能调用后端API
- [ ] LLM能回答基础问题

---

### 里程碑2: 第5周末
**检查项**:
- [ ] 用户提问能获得结构化回答
- [ ] 至少5个分子的3D可视化
- [ ] 基础UI可用

---

### 里程碑3: 第8周末
**检查项**:
- [ ] 完整问答流程可用
- [ ] 方程式生成功能可用
- [ ] 知识图谱检索可用

---

### 里程碑4: 第12周末
**检查项**:
- [ ] 追问功能可用
- [ ] 练习题生成可用
- [ ] MVP功能完整

---

## 开发规范

### Git分支策略
```
main        ← 生产环境
  ↑
develop     ← 开发主分支
  ↑
feature/*   ← 功能分支 (feature/3d-viewer, feature/equation)
  ↑
fix/*       ← 修复分支
```

### 提交规范
```
feat: 添加3D分子查看器
fix: 修复方程式显示bug
docs: 更新API文档
refactor: 重构LLM服务
```

---

## 风险应对

| 风险 | 应对措施 |
|-----|---------|
| LLM回答不准确 | 添加知识库校验，提供反馈机制 |
| 3D渲染性能差 | 使用简化模型，懒加载 |
| API成本超预算 | 常见问题缓存，使用更便宜的模型 |
| 进度延期 | 每周检查，及时调整优先级 |

---

## 下一步行动

**本周任务**:
1. [ ] 确认技术栈
2. [ ] 创建前后端项目
3. [ ] 实现基础UI框架
4. [ ] 搭建FastAPI服务

**所需资源**:
- OpenAI API Key 或其他LLM访问权限
- Neo4j数据库（可先用Docker本地运行）
- 开发环境：Node.js 18+, Python 3.10+

---

**文档结束**
